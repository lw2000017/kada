# coding:utf-8
import requests
import json
# from requests.packages import urllib3
# import logging

def get_book_list(htt, hhdd_dict):
    url_book_n = htt + "/book2/otherCollectList.json"

    # 随便看看 绘本 第一页数据
    list_sourceId = []
    dict_souceId = {}
    dict_souceId_number = {}
    list_sourceId_old = []
    #
    # paging_size = 60
    # paging_number = 1
    #
    # payload = {'pagingSize': paging_size, 'pagingNumber': paging_number}

    userId = hhdd_dict['userId']
    token = hhdd_dict['token']
    extTime = hhdd_dict['extTime']

    cookie_hhdd = "_HHDD_=\"{\\\"userId\\\":\\\"" + userId + "\\\",\\\"nick\\\":\\\"\\\",\\\"token\\\":\\\"" + token + "\\\",\\\"login\\\":\\\"false\\\",\\\"extTime\\\":\\\"" + extTime + "\\\"}\""
    # 'KaDa/3.6.0 (iPhone; iOS 11.3; Scale/3.00)',
    headers = {
        'user-agent': 'KaDa/3.7.3 (iPhone; iOS 8.0; Scale/2.00)',
        'rdi': "DT=iPhone6,2;SV=8.0;AV=3.7.3.1",
        'Cookie': cookie_hhdd,
        'Date': 'Tue, 06 Nov 2018 08:58:33 GMT',
        'Accept': '*/*',
        'Authorization': 'PiMAJldfLC8lW2F0Gx4EFSEANmASYHNUDnsWFydlVHtLZX1TWksaCBpKHHVvE3xDGwM=',
        'Connection': 'keep-alive',
        'Host': 'service.hhdd.com'
    }

    # probation_plan_sourceId_list = [53159, 50081, 50104, 53157, 50723, 53155, 50625, 51416, 53293, 50067, 53161, 50156, 52120, 53154, 53302, 50125, 50103, 50105, 50070, 51003, 53664, 50834, 53482, 51088, 53156, 53483, 50075, 53303, 50998, 53160, 51269, 50097, 51455, 50146, 51087, 50626, 51276, 53667, 50726, 51564, 51259, 52024, 51997, 50623, 50119, 50074, 55132, 55151, 53162, 53623, 50624, 53485, 51311, 53179, 51239, 53549, 51301, 51029, 50994, 53243, 53332, 53121, 51249, 50789, 53665, 51684, 51477, 50107, 53151, 50501, 51037, 50109, 50043, 51967, 50138, 53133, 54926, 50145, 55152, 50096, 53131, 51032, 50065, 51034, 52249, 51337, 50406, 51844, 51350, 53313, 52805, 50083, 50633, 51812, 50839, 51438, 50995, 53134, 53178, 50100, 52741, 51243, 52832, 50099, 50763, 51849, 50033, 52314, 50853, 53314, 52203, 50776, 50112, 50616, 53661, 50136, 51594, 50795, 52323, 52731, 52733, 54581, 52732, 51030, 51555, 53119, 55199, 53490, 55200, 52591, 51112, 53111, 53092, 51113, 53558, 53112, 51681, 51783, 51974, 50047, 52593, 50128, 50850, 51925, 52923, 52567, 50892, 50073, 53559, 50399, 55205, 50115, 51380, 52536, 51710, 53528, 51920, 52187, 52259, 51825, 51679, 50036, 55128, 50500, 51721, 50689, 50790, 52553, 50147, 51642, 51512, 51971, 50650, 50649, 51731, 50870, 55197, 54927, 50983, 53601, 51323, 54928, 55203, 53428, 50651, 51233, 53244, 50579, 53409, 53152, 55204, 52922, 52586, 52587, 53246, 52114, 51972, 50605, 53407, 50982, 53408, 50615, 50751, 50515, 52287, 50048, 52081, 50420, 50895, 52027, 51242, 55202, 51434, 52544, 50102, 51678, 51921, 54711, 53534, 51986, 52552, 53410, 52585, 52565, 53669, 52028, 53682, 50407, 50843, 54601, 50377, 50359, 50974, 55311, 52083, 51988, 53487, 54640, 50068, 52361, 51258, 50388, 54991, 53553, 51231, 52551, 50416, 52493, 54900, 52413, 52548, 53242, 52410, 53580, 54356, 50606, 55021, 51209, 51916, 52283, 52494, 51667, 52885, 50349, 52097, 53334, 51437, 52549, 52967, 53102, 52235, 50076, 50672, 53684, 52412, 51727, 52642, 53105, 53681, 51774, 55471, 53091, 50038, 53271, 52109, 51118, 50064, 50443, 52722, 52543, 50728, 55120, 50085, 50886, 51074, 50685, 50864, 52800, 50356, 52884, 51865, 51926, 51110, 50051, 52116, 50444, 52814, 52881, 51205, 51442, 51585, 53176, 51561, 50803, 53603, 53551, 51629, 50077, 52352, 53002, 52084, 50999, 52205, 50679, 50984, 51397, 53613, 50357, 53113, 50370, 51791, 53702, 50088, 50044, 50740, 53106, 53252, 52886, 53604, 51449, 51400, 52363, 51830, 50553, 51954, 50375, 50387, 52701, 53488, 52322, 53411, 51142, 51379, 52882, 52371, 53120, 55131, 52541, 53614, 50769, 50855, 51875, 51652, 53818, 53658, 51960, 52742, 51440, 50140, 51588, 55371, 53116, 50683, 50785, 51782, 51725, 51000, 51267, 53219, 53245, 53220, 50762, 50362, 53671, 50671, 52963, 55207, 53174, 50391, 50371, 50883, 50394, 52252, 50953, 55315, 50363, 51156, 55301, 50878, 52961, 51752, 51846, 55402, 53027, 51436, 51107, 50930, 50931, 50675, 53532, 53254, 51724, 51918, 53013, 50673, 52495, 51959, 52909, 50397, 51462, 51150, 50382, 53175, 50707, 51353, 50367, 55342, 51699, 52696, 53218, 52702, 50916, 55079, 50117, 52298, 50378, 50543, 52664, 50662, 50634, 50765, 53611, 50374, 51847, 51001, 53117, 52055, 50353, 53522, 50440, 50899, 52721, 51146, 51683, 52970, 50130, 52540, 54981, 52929, 50052, 50591, 51456, 51234, 50405, 53489, 51644, 50365, 51963, 50423, 50464, 50050, 51985, 52062, 50922, 55431, 50398, 52883, 50668, 51723, 52392, 51889, 51333, 51751, 52969, 50879, 51651, 51696, 55438, 51984, 50670, 52393, 51923, 55346, 50801, 51556, 50881, 50809, 50808, 53114, 51439, 50664, 51955, 51091, 52542, 50389, 51843, 52262, 51700, 55461, 50836, 50424, 51433, 51049, 52186, 50786, 52871, 50667, 53273, 52703, 52385, 51109, 52592, 50547, 52315, 50665, 51861, 51811, 50585, 50686, 51957, 50412, 50806, 50722, 51349, 51108, 51378, 50066, 50718, 53581, 50684, 50361, 52707, 50372, 52695, 50379, 53840, 53058, 53576, 51638, 50046, 50807, 55451, 50636, 51653, 55443, 50380, 50502, 51893, 50976, 50390, 50800, 52962, 50987, 52011, 51414, 51917, 50970, 51391, 55218, 51596, 51732, 52414, 50360, 55209, 51620, 52491, 50427, 53556, 52764, 51951, 51388, 55125, 51664, 51255, 54354, 50813, 51098, 51891, 50154, 52908, 52763, 50744, 50063, 51117, 50439, 50897, 51515, 50681, 50403, 51253, 52246, 52162, 51143, 52198, 53486, 55196, 52365, 50906, 50351, 50385, 50805, 50344, 50842, 53093, 55435, 50680, 52911, 50660, 51322, 51565, 51763, 52817, 50429, 51778, 50658, 50437, 51878, 51458, 52274, 53832, 52182, 51236, 50706, 52986, 53255, 50527, 51945, 51968, 50996, 52199, 50542, 51726, 50346, 50400, 51484, 50721, 50084, 53552, 50393, 52256, 51775, 52827, 51360, 51247, 51781, 53612, 55344, 50548, 52831, 52021, 51444, 50122, 50123, 50417, 51697, 51662, 51877, 51341, 50880, 51254, 53491, 50499, 52487, 51628, 52407, 52212, 52743, 51982, 50384, 50497, 51899, 53662, 50495, 52937, 50838, 51384, 51425, 55404, 52293, 50875, 52907, 50802, 55192, 50663, 50659, 50419, 51562, 53021, 51958, 51351, 50739, 51574, 50366, 51948, 51264, 50514, 51802, 50466, 52866, 51704, 51193, 51953, 50963, 50137, 50489, 53841, 53054, 51691, 52933, 51347, 53495, 55220, 51270, 50546, 52799, 52715, 51017, 52032, 51464, 51848, 50072, 51569, 50657, 52023, 50743, 52333, 50430, 50376, 53842, 50582, 51741, 50496, 51792, 50587, 51658, 50538, 51480, 51395, 51608, 51361, 50494, 51965, 50682, 51261, 51964, 50493, 51601, 50563, 50884, 51348, 50536, 51801, 52282, 51123, 52671, 50108, 51730, 51140, 52951, 52638, 50782, 51381, 52905, 51412, 51761, 53533, 53062, 55341, 54901, 50540, 50418, 51387, 53272, 51692, 52208, 51336, 53547, 50507, 52930, 50474, 52872, 50350, 52091, 50383, 51637, 51262, 51991, 51981, 52250, 52570, 52382, 50560, 50595, 51944, 52251, 53253, 53053, 50592, 52275, 51690, 55381, 51648, 51566, 50904, 51263, 51950, 51096, 55432, 52364, 52762, 51470, 51012, 52142, 50578, 53103, 52771, 51880, 51551, 53833, 50986, 51106, 50661, 52231, 51927, 52865, 50411, 51272, 50702, 55421, 51779, 52206, 51331, 51483, 50373, 51251, 51649, 50594, 51204, 50989, 51277, 53560, 51563, 53571, 50413, 52654, 52852, 51097, 51362, 51467, 51894, 50948, 51962, 52830, 53211, 51443, 50771, 51417, 50905, 52108, 50735, 52319, 52345, 50396, 52258, 50485, 51616, 50545, 51693, 52676, 52074, 52001, 52326, 50583, 51983, 52191, 50637, 51687, 52223, 52273, 53055, 51085, 51611, 53251, 55206, 53574, 50734, 52342, 53170, 50438, 53406, 51929, 52966, 52864, 51851, 51626, 50935, 51665, 51343, 51196, 51047, 52869, 51646, 52201, 52277, 52403, 50604, 52931, 51703, 50492, 55441, 52879, 52853, 51636, 53575, 53115, 52279, 52854, 52172, 53063, 51722, 51966, 50912, 53202, 51532, 52381, 51572, 51473, 50690, 51491, 51435, 50506, 52761, 50577, 52861, 50484, 51002, 51773, 52697, 52325, 50041, 53011, 50121, 51126, 52118, 51623, 51518, 51246, 51016, 50111, 52868, 50442, 53834, 54909, 53082, 51712, 51095, 53685, 50551, 52051, 52880, 50856, 51701, 51603, 52204, 52673, 53250, 50523, 50414, 52926, 52716, 51392, 51148, 52661, 52932, 51659, 51728, 50874, 52411, 53572, 52900, 51159, 51149, 50666, 52391, 50641, 50784, 53703, 52255, 50979, 51931, 50714, 52106, 55433, 52384, 51094, 50080, 52217, 55161, 50368, 51044, 51827, 52936, 51468, 51121, 51780, 51122, 52131, 50386, 51591, 51999, 51643, 52243, 51654, 51911, 52404, 51866, 52554, 51590, 52054, 52179, 51632, 52286, 51474, 51883, 52550, 50745, 55361, 51579, 51052, 52052, 51598, 51471, 50603, 51198, 51842, 50764, 52829, 51420, 53172, 50508, 52031, 53531, 52064, 51411, 50513, 52906, 51705, 50132, 50124, 51354, 51776, 52547, 51573, 51145, 50947, 55322, 52087, 51007, 51418, 51399, 50799, 52095, 51153, 50566, 50760, 52295, 51657, 55219, 52658, 50958, 53052, 51120, 51542, 52974, 50861, 51266, 52719, 51998, 51892, 51777, 53622, 51709, 52486, 52409, 50521, 55314, 51771, 52942, 51245, 52053, 51863, 50564, 52692, 54285, 50525, 52316, 51250, 50761, 54910, 51666, 50840, 50134, 52718, 53657, 51729, 53171, 51424, 51469, 55312, 51924, 50992, 52744, 52324, 50710, 51592, 51823, 51615, 52094, 51935, 52072, 52698, 53274, 50609, 50911, 52965, 54361, 50032, 51826, 52030, 52183, 52700, 50985, 50692, 52096, 51321, 50704, 52068, 50698, 52928, 51647, 52224, 51873, 51607, 50737, 51413, 51163, 52284, 51645, 52652, 51933, 51898, 52207, 50517, 53654, 51014, 53281, 51151, 55321, 50688, 51050, 50602, 51639, 52192, 52651, 52694, 53656, 51656, 50133, 51670, 51176, 50687, 52964, 51359, 51867, 52653, 53846, 52714, 53524, 50598, 55401, 50788, 52821, 51450, 51240, 52098, 50572, 50774, 52819, 52824, 51257, 50408, 50957, 52362, 52823, 50589, 51821, 50581, 53061, 51466, 51238, 51593, 52561, 51663, 53012, 51897, 52987, 52291, 52194, 50891, 50719, 52870, 50568, 52225, 51806, 51463, 50580, 51162, 50510, 50584, 53843, 53173, 50798, 52041, 53655, 51772, 50693, 51445, 52161, 50552, 51489, 51358, 50898, 50415, 51482, 50700, 52851, 51168, 51235, 50775, 52816, 52867, 51824, 50434, 54351, 51155, 50938, 51803, 52189, 50914, 51479, 52180, 51133, 50588, 51465, 55411, 53845, 53023, 54908, 51882, 52171, 51201, 51655, 52102, 51650, 50696, 51192, 52462, 51613, 51129, 50703, 50913, 51989, 52818, 51476, 51995, 52245, 51733, 51053, 50465, 51586, 51045, 52944, 52099, 50954, 53081, 51597, 51568, 52934, 52100, 50901, 52339, 51680, 52940, 51161, 50865, 51018, 52708, 50467, 53835, 52546, 51612, 50900, 53837, 50402, 51913, 51075, 52804, 53573, 50993, 52665, 51457, 52253, 52303, 51332, 52232, 52711, 50950, 50932, 51160, 50071, 50590, 50695, 51695, 50596, 51805, 53523, 53025, 52863, 50944, 55208, 53838, 51922, 50600, 53283, 50511, 51887, 53844, 53660, 52988, 51021, 53024, 51900, 51244, 53026, 53847, 51641, 50952, 51357, 50716, 52299, 50715, 54166, 54637, 61719, 51157, 52985, 53836, 51195, 51554, 51461, 50960, 52188, 50951, 51831, 52943, 50711, 51475, 53064, 50887, 52177, 51130, 52776, 50873, 50554, 50708, 51386, 52104, 52820, 52842, 51022, 53212, 52562, 50699, 50959, 51207, 52973, 50910, 51881, 50908, 53550, 51252, 52538, 50697, 50597, 51385, 50946, 52175, 50961, 50717, 50608, 51005, 52254, 51762, 51698, 50691, 52899, 51019, 52292, 55434, 50617, 55129, 51232, 50709, 52075, 51194, 51158, 52773, 50593, 50964, 51486, 52341, 51919, 52101, 50601, 51606, 53831, 52278, 50962, 51884, 51271, 51890, 52968, 53107, 50347, 50955, 50945, 51256, 51614, 50867, 53839, 51342, 51131, 51371, 50779, 50694, 52302, 52991, 51165, 51605, 51915, 52073, 51202, 52103, 51283, 55347, 50796, 51602, 50780, 52990, 50915, 51822, 52343, 53653, 51127, 51390, 51617, 51885, 53057, 50909, 50949, 52941, 51631, 51134, 52200, 52921, 55201, 51208, 54165, 50939, 52901, 50705, 51023, 50586, 52174, 52276, 50599, 52061, 52066, 51164, 53543, 51125, 52903, 51203, 50712, 50772, 50956, 50395, 51197, 55345, 51191, 52902, 51135, 52190, 52952, 50866, 53548, 50907, 51020, 52132, 51166, 51167, 53544, 51175, 50943, 50701, 51930, 51132, 51128, 51124, 63461, 62904, 50131, 51460]

    #
    probation_plan_sourceId_list = [66763, 66000, 66675, 65583, 66538, 66672, 60649, 65003, 64537, 64544, 64542, 64545, 62577, 60606, 65008, 65331, 60724, 64533]




    n = 0
    paging_size = 60

    for paging_number in range(1, 9):
        # urllib3.disable_warnings()
        # logging.captureWarnings(True)
        payload = {'pagingSize': paging_size, 'pagingNumber': paging_number}
        r = requests.get(url=url_book_n, headers=headers, params=payload)
        a_dict = r.json()
        print(a_dict)
        data_len = len(a_dict['data'])
        data_List = a_dict['data']
        list_sourceId = []

        for data in data_List:
            if data['type'] == 1:
                list_sourceId.append(data['sourceId'])

        for sourceId in list_sourceId:
            num = 0
            num = list_sourceId.count(sourceId)
            if num > 1:
                print(paging_number, sourceId, num)
                print("----------------------------分割线------------------------")

        for sourceId in list_sourceId:
            #
            # t = (sourceId in list_sourceId_old)
            # dict_souceId[sourceId] = t

            if sourceId in probation_plan_sourceId_list:
                n = n + 1
                print(n)
                print(sourceId, paging_number)




            #
            #
            # if dict_souceId.get(sourceId):
            #     if dict_souceId_number.get(sourceId):
            #         num = dict_souceId_number[sourceId] + 1
            #         dict_souceId_number[sourceId] = num
            #     else:
            #         dict_souceId_number[sourceId] = 1

        print("第{0}页获取绘本总个数{1}个--------".format(paging_number, data_len))
        # print(paging_number, dict_souceId)
        json_name = 'book2_otherCollectList' + str(paging_number) + '.json'
        with open(json_name, 'w') as json_file:
            json.dump(a_dict, json_file, ensure_ascii=False, indent=4)

    print("souceId比较结果：", dict_souceId)

    print("souceId出现次数：", dict_souceId_number)

if __name__ == '__main__':
    htt = "http://10.0.10.61"
    # htt = "https://service.hhdd.com"
    hhdd_dict = {'userId': '60006991',
                 'token': "1539956bc1d00b3f39dbe5a5ad33577d",
                 'extTime': '1572574301381'
    }

    get_book_list(htt=htt, hhdd_dict=hhdd_dict)
